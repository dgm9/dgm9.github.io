<!DOCTYPE html>
<html lang="en">
<head>
        <title>dgm9 (david mikolas) : Orbits I</title>
        <meta charset="utf-8" />
        <link rel="stylesheet" href="/theme/css/main.css" type="text/css" />
        <link href="/" type="application/atom+xml" rel="alternate" title="dgm9 (david mikolas) ATOM Feed" />

        <!--[if IE]>
                <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

        <!--[if lte IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="/css/ie.css"/>
                <script src="/js/IE8.js" type="text/javascript"></script><![endif]-->

        <!--[if lt IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="/css/ie6.css"/><![endif]-->

</head>

<body>
        
<header>
    <h1><a href="/orbits-i.html" id="page-title">Orbits I</a></h1>
    <span id="sitename"><a href="" id="site-title">dgm9 (david mikolas) </a> &sdot;</span>
<time datetime="2015-06-02T00:00:00-04:00">Tue 02 June 2015</time></header>
<article>
    <img alt="newton" src="/images/Newton_test_meme_resize2.png" />
<img alt="newton" src="/images/my_man_Isaac_Newton_y537MD.gif" />
<div class="section" id="so-that-s-my-man-isaac-newton">
<h2><em>&quot;so... that's my man, Isaac Newton&quot;</em></h2>
<p>Watch the video <a class="reference external" href="https://www.youtube.com/watch?v=danYFxGnFxQ">here</a>:  (English subtitles are available)</p>
<p>Newton (along with others) invented calculus in part to understand what’s going on behind Keppler’s laws – e.g. 'why are the orbits of the planets elliptical, with the sun at one focus'? He showed that this is the result of an inverse square behavior of gravity.</p>
<p>On earth, the strength of gravity seemed about the same everywhere. But, by studying the motion of the planets (including earth) it was possible to see that the force of gravity decreased inversely as the square of the distance from the sun. Here is how this is expressed in both scalar, and vector form (vectors will be bold font):</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<img alt="figure_1" src="/images/figi01altw.png" />
<p>Sometimes it’s easier to code if you just write it this way:</p>
<img alt="figure_2" src="/images/figi02w.png" />
<p>The simplest imaginable way to try to calculate orbits (with a computer) is probably just using finite differences:</p>
<img alt="figure_3" src="/images/figi03w.png" />
<p>So here is a simple python script to try yourself. Note that Gm (the product of G and the mass of the sun) is known much more precisely than either G or m alone. Can you guess why? Imagine trying to measure one without the other!</p>
<p>Also:</p>
<img alt="/figure_3.1" src="images/figi03point1w.png" />
<div class="highlight"><pre><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.cm</span> <span class="kn">as</span> <span class="nn">cm</span>
<span class="kn">import</span> <span class="nn">math</span>

<span class="n">Gm</span> <span class="o">=</span> <span class="mf">1.3271244002E+20</span>  <span class="c"># m^3 s^-2               (Wikipedia)</span>
<span class="n">e</span> <span class="o">=</span> <span class="mf">0.01671123</span>         <span class="c"># earth eccentricity     (Wikipedia)</span>
<span class="n">a</span> <span class="o">=</span> <span class="mf">1.49598261E+11</span>     <span class="c"># earth semi-major axis  (Wikipedia)</span>

<span class="c"># r = a(1-e^2)/(1+e*cos(theta)) an equation for an ellipse</span>
<span class="n">r_aphelion</span>   <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="n">e</span><span class="p">)</span>
<span class="n">r_perihelion</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">e</span><span class="p">)</span>

<span class="c"># using vis-viva equation v^2 = Gm * (2./r - 1./a) (Wikipedia)</span>
<span class="c"># (this is really just conservation of energy: Kinetic + Potential = const)</span>
<span class="n">v_aphelion</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Gm</span> <span class="o">*</span> <span class="p">(</span><span class="mf">2.</span><span class="o">/</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">e</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">)</span> <span class="o">/</span> <span class="n">a</span><span class="p">)</span>

<span class="n">t_year</span> <span class="o">=</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a</span><span class="o">**</span><span class="mi">3</span><span class="o">/</span><span class="n">Gm</span><span class="p">)</span>

<span class="n">nstep</span> <span class="o">=</span> <span class="mi">100</span>   <span class="c"># CHANGE THIS TO SEE WHAT HAPPENS!</span>

<span class="n">Dt</span> <span class="o">=</span> <span class="n">t_year</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">nstep</span><span class="p">)</span>   <span class="c"># time step</span>

<span class="n">V</span> <span class="o">=</span> <span class="p">[(</span><span class="mf">0.0</span><span class="p">,</span>         <span class="n">v_aphelion</span><span class="p">)]</span>
<span class="n">X</span> <span class="o">=</span> <span class="p">[(</span><span class="n">r_aphelion</span><span class="p">,</span>  <span class="mf">0.0</span>       <span class="p">)]</span>
<span class="n">T</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span>

<span class="n">x</span><span class="p">,</span>  <span class="n">y</span>  <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">vx</span><span class="p">,</span> <span class="n">vy</span> <span class="o">=</span> <span class="n">V</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nstep</span><span class="p">):</span>

    <span class="n">one_over_r3</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**-</span><span class="mf">1.5</span>

    <span class="n">vx</span> <span class="o">+=</span> <span class="o">-</span><span class="n">Dt</span> <span class="o">*</span> <span class="n">Gm</span> <span class="o">*</span> <span class="n">x</span> <span class="o">*</span> <span class="n">one_over_r3</span>
    <span class="n">vy</span> <span class="o">+=</span> <span class="o">-</span><span class="n">Dt</span> <span class="o">*</span> <span class="n">Gm</span> <span class="o">*</span> <span class="n">y</span> <span class="o">*</span> <span class="n">one_over_r3</span>

    <span class="n">x</span>  <span class="o">+=</span>  <span class="n">Dt</span> <span class="o">*</span> <span class="n">vx</span>
    <span class="n">y</span>  <span class="o">+=</span>  <span class="n">Dt</span> <span class="o">*</span> <span class="n">vy</span>
    <span class="n">t</span>  <span class="o">+=</span>  <span class="n">Dt</span>

    <span class="n">V</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">vx</span><span class="p">,</span> <span class="n">vy</span><span class="p">))</span>
    <span class="n">X</span><span class="o">.</span><span class="n">append</span><span class="p">((</span> <span class="n">x</span><span class="p">,</span>  <span class="n">y</span><span class="p">))</span>
    <span class="n">T</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

<span class="n">gap</span>   <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">X</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>   <span class="o">+</span> <span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="n">v_gap</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">V</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">V</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>   <span class="o">+</span> <span class="p">(</span><span class="n">V</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">V</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

<span class="k">print</span> <span class="n">nstep</span><span class="p">,</span> <span class="n">gap</span><span class="p">,</span> <span class="n">v_gap</span>

<span class="n">plot_it</span> <span class="o">=</span> <span class="bp">True</span>
<span class="n">save_it</span> <span class="o">=</span> <span class="bp">True</span>
<span class="n">save_name</span> <span class="o">=</span> <span class="s">&#39;nicefig&#39;</span>

<span class="k">if</span> <span class="n">nstep</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="o">**</span><span class="mi">5</span><span class="p">:</span>
    <span class="n">plot_it</span> <span class="o">=</span> <span class="bp">False</span>   <span class="c"># don&#39;t be silly!</span>
</pre></div>
<p>And the next zillion lines just make the plots.</p>
<p>I've made it complex (which is at least <a class="reference external" href="http://zen-of-python.info/complex-is-better-than-complicated.html">better</a> than <a class="reference external" href="http://stackoverflow.com/questions/4568704/what-does-complex-is-better-than-complicated-mean">complicated</a>) to expose you to a number things that sooner or later we need to learn about python and matplotlib.</p>
<div class="highlight"><pre><span class="k">if</span> <span class="n">plot_it</span><span class="p">:</span>

    <span class="n">r</span> <span class="o">=</span> <span class="p">[</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="ow">in</span> <span class="n">X</span><span class="p">]</span>
    <span class="n">x</span><span class="p">,</span>    <span class="n">y</span>    <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">X</span><span class="p">)</span>
    <span class="n">vx</span><span class="p">,</span>   <span class="n">vy</span>   <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">V</span><span class="p">)</span>
    <span class="n">tmin</span><span class="p">,</span> <span class="n">tmax</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">T</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>

    <span class="n">tcolor</span> <span class="o">=</span> <span class="p">[(</span><span class="n">tt</span><span class="o">-</span><span class="n">tmin</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">tmax</span><span class="o">-</span><span class="n">tmin</span><span class="p">)</span> <span class="k">for</span> <span class="n">tt</span> <span class="ow">in</span> <span class="n">T</span><span class="p">]</span>

    <span class="n">tc2</span> <span class="o">=</span> <span class="p">[</span><span class="n">tt</span><span class="o">*</span><span class="mf">0.6</span> <span class="o">+</span> <span class="mf">0.2</span> <span class="k">for</span> <span class="n">tt</span> <span class="ow">in</span> <span class="n">tcolor</span><span class="p">]</span> <span class="c"># avoid dark red/blue</span>

    <span class="n">cmap</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">jet</span>
    <span class="n">c</span><span class="p">,</span> <span class="n">cfirst</span><span class="p">,</span> <span class="n">clast</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">(</span><span class="n">tc2</span><span class="p">),</span> <span class="n">cmap</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">tc2</span><span class="p">)),</span> <span class="n">cmap</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">tc2</span><span class="p">))</span>

    <span class="n">dgrey</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>  <span class="c"># darker gray</span>
    <span class="n">lgrey</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">)</span>  <span class="c"># lighter gray</span>
    <span class="n">fsl</span>  <span class="o">=</span> <span class="mi">16</span>                <span class="c"># font size for axis labels</span>
    <span class="n">fs</span>   <span class="o">=</span> <span class="mi">14</span>                <span class="c"># font size for tick labels</span>

    <span class="n">params</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;lines.color&#39;</span><span class="p">,</span> <span class="s">&#39;xtick.color&#39;</span><span class="p">,</span> <span class="s">&#39;ytick.color&#39;</span><span class="p">,</span>
              <span class="s">&#39;axes.labelcolor&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="n">param</span><span class="p">]</span> <span class="o">=</span> <span class="n">lgrey</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;axes.edgecolor&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">dgrey</span>  <span class="c"># this one darker</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">11</span><span class="p">,</span><span class="mf">3.5</span><span class="p">))</span>          <span class="c"># here is the figure</span>
    <span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.08</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">])</span>   <span class="c"># axes for three plots</span>
    <span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.41</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">])</span>
    <span class="n">ax3</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.64</span><span class="p">,</span> <span class="mf">0.40</span><span class="p">,</span> <span class="mf">0.30</span><span class="p">,</span> <span class="mf">0.55</span><span class="p">])</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">patch</span><span class="o">.</span><span class="n">set_alpha</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>

    <span class="c"># FIRST PLOT</span>
    <span class="n">line</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>     <span class="c"># scatter plot of all points</span>
    <span class="n">line</span><span class="o">.</span><span class="n">set_facecolors</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>             <span class="c"># go back and change color of each one</span>
    <span class="n">line</span><span class="o">.</span><span class="n">set_edgecolors</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
    <span class="n">l</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>  <span class="c"># make a big blue one for starting point</span>
    <span class="n">l</span><span class="o">.</span><span class="n">set_facecolors</span><span class="p">(</span><span class="s">&#39;b&#39;</span><span class="p">)</span>
    <span class="n">l</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">120</span><span class="p">)</span>   <span class="c"># the sun!</span>
    <span class="n">l</span><span class="o">.</span><span class="n">set_facecolors</span><span class="p">((</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">))</span>  <span class="c"># is yellow?</span>
    <span class="n">l</span><span class="o">.</span><span class="n">set_edgecolors</span><span class="p">((</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">))</span>  <span class="c"># with an orange photosphere? not really!</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">arrow</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.25</span><span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="n">head_width</span><span class="o">=</span><span class="mf">0.08</span><span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="n">head_length</span><span class="o">=</span><span class="mf">0.16</span><span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">)</span> <span class="c">#</span>

    <span class="n">hwbox</span> <span class="o">=</span> <span class="mf">1.6E+11</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mf">0.0</span> <span class="o">-</span> <span class="n">hwbox</span><span class="p">,</span> <span class="mf">0.0</span> <span class="o">+</span> <span class="n">hwbox</span><span class="p">])</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mf">0.0</span> <span class="o">-</span> <span class="n">hwbox</span><span class="p">,</span> <span class="mf">0.0</span> <span class="o">+</span> <span class="n">hwbox</span><span class="p">])</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;x(m)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="n">fsl</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">lgrey</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;y(m)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="n">fsl</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">lgrey</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span> <span class="o">=</span> <span class="n">fs</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">lgrey</span><span class="p">)</span>


    <span class="c"># SECOND PLOT</span>
    <span class="n">hwbox</span> <span class="o">=</span> <span class="mf">2E+10</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s">&#39;-k&#39;</span><span class="p">)</span>
    <span class="n">l</span> <span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">240</span><span class="p">)</span>
    <span class="n">l</span><span class="o">.</span><span class="n">set_facecolors</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">line</span> <span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
    <span class="n">line</span><span class="o">.</span><span class="n">set_facecolors</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
    <span class="n">line</span><span class="o">.</span><span class="n">set_edgecolors</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">arrow</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.25</span><span class="o">*</span><span class="n">hwbox</span><span class="p">,</span> <span class="n">head_width</span><span class="o">=</span><span class="mf">0.05</span><span class="o">*</span><span class="n">hwbox</span><span class="p">,</span> <span class="n">head_length</span><span class="o">=</span><span class="mf">0.1</span><span class="o">*</span><span class="n">hwbox</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">)</span> <span class="c">#</span>

    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">hwbox</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">hwbox</span><span class="p">])</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">hwbox</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">hwbox</span><span class="p">])</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;x (m)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="n">fsl</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">lgrey</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;y (m)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="n">fsl</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">lgrey</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span> <span class="o">=</span> <span class="n">fs</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">lgrey</span><span class="p">)</span>

    <span class="c"># THIRD PLOT</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="s">&#39;-b&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span> <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">T</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">T</span><span class="p">)],</span> <span class="p">[</span><span class="n">r_aphelion</span><span class="p">,</span>   <span class="n">r_aphelion</span><span class="p">],</span> <span class="s">&#39;-k&#39;</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span> <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">T</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">T</span><span class="p">)],</span> <span class="p">[</span><span class="n">r_perihelion</span><span class="p">,</span> <span class="n">r_perihelion</span><span class="p">],</span> <span class="s">&#39;-k&#39;</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;r (m)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="n">fsl</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">lgrey</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;time (sec)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="n">fsl</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">lgrey</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span> <span class="o">=</span> <span class="n">fs</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">lgrey</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="p">[</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span><span class="p">]:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">patch</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="n">dgrey</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">patch</span><span class="o">.</span><span class="n">set_alpha</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>

    <span class="n">line_1</span> <span class="o">=</span> <span class="s">&#39;nstep  =  &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">nstep</span><span class="p">)</span>
    <span class="n">line_2</span> <span class="o">=</span> <span class="s">&#39;gap    =  &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">gap</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="s">&#39; m&#39;</span>
    <span class="n">line_3</span> <span class="o">=</span> <span class="s">&#39;v_gap  =  &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">v_gap</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span> <span class="o">+</span> <span class="s">&#39; m/s&#39;</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.62</span><span class="p">,</span> <span class="mf">0.19</span><span class="p">,</span> <span class="n">line_1</span><span class="p">,</span> <span class="n">horizontalalignment</span> <span class="o">=</span> <span class="s">&#39;left&#39;</span><span class="p">,</span>
             <span class="n">verticalalignment</span> <span class="o">=</span> <span class="s">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">16</span><span class="p">,</span>
             <span class="n">color</span> <span class="o">=</span> <span class="n">lgrey</span><span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.62</span><span class="p">,</span> <span class="mf">0.12</span><span class="p">,</span> <span class="n">line_2</span><span class="p">,</span> <span class="n">horizontalalignment</span> <span class="o">=</span> <span class="s">&#39;left&#39;</span><span class="p">,</span>
             <span class="n">verticalalignment</span> <span class="o">=</span> <span class="s">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">16</span><span class="p">,</span>
             <span class="n">color</span> <span class="o">=</span> <span class="n">lgrey</span><span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.62</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="n">line_3</span><span class="p">,</span> <span class="n">horizontalalignment</span> <span class="o">=</span> <span class="s">&#39;left&#39;</span><span class="p">,</span>
             <span class="n">verticalalignment</span> <span class="o">=</span> <span class="s">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">16</span><span class="p">,</span>
             <span class="n">color</span> <span class="o">=</span> <span class="n">lgrey</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">save_it</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save_name</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
<p>Just to note: the following values (Wikipedia)</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Gm:</th><td class="field-body">1.3271244002E+20  m^3 s^-2</td>
</tr>
<tr class="field"><th class="field-name">e:</th><td class="field-body">0.01671123</td>
</tr>
<tr class="field"><th class="field-name">a:</th><td class="field-body">1.49598261E+11  m</td>
</tr>
</tbody>
</table>
<p>give the period of an orbit of 31558319.5 seconds, or about 365.25833 days. In reality, a year on earth is about 365.25636 days. This difference is probaly due to our simplifying assumption that the sun just sits in one place and the earth rotates around it. In reality the masses of the sun and earth are roughly 1.989E+30 and 5.972E+24 (Wikipedia) and if they were alone, the'd rotate around a common barycenter. You can see the difference in the year, and the ratio of the masses are both of the order 10E-06. But instead of looking at reduced mass yet, let's just see what happens.</p>
<p>Here are some results. Distances are in meters, time in seconds, etc. The total time is the theoretical period (one year) based on the values used for Gm, e, and a, assuming the earth's mass is very small, and no other planets. If the calculation were correct, then the earth should return to exactly the same position after a period of time given by <em>t_year</em>.</p>
<p>Color is used to represent time (from blue to red - indicated by arrow also). The plot on the left is the whole orbit (sun at one focus). The center plot is a zoom in on the starting position. On the right, the radial distance to the sun is plotted agatinst time. The horizontal lines indicate perihelion and aphelion.</p>
<img alt="Figure_04" src="/images/figi04.png" />
<p>In this first simulation (above) where only 50 time steps were used for an entire orbit, the results are obviously extremely bad. The earth doesn’t return to the same spot (center plot), and the variation of the distance to the sun (right plot) is right <a class="reference external" href="https://www.google.com.tw/search?q=five+is+right+out">out</a>! The &quot;gaps&quot; are the difference between initial and final values. Should be zero if we are orbiting correctly.</p>
<img alt="Figure_05" src="/images/figi05.png" />
<div class="line-block">
<div class="line"><br /></div>
</div>
<img alt="Figure_06" src="/images/figi06.png" />
<p>With 200 and 1000 steps, it's not quite dead - it's getting better, and it doesn't want to go on the cart. We know how that <a class="reference external" href="http://en.wikiquote.org/wiki/Monty_Python_and_the_Holy_Grail#Dialogue">story</a> ends - it's all down hill. But if we plot it, it's not really going down hill fast enough, especially if we want to start calculating more complicated things.</p>
<img alt="Figure_07" src="/images/figi07.png" />
<p>Orbits with large eccentricity are much more demanding because the forces are changing quickly. A quick way to make the orbit elliptical is to just cut the intial velocity in half, and let the planet fall towards the sun. I'm too lazy to recalculate the theoretical period - you can do that 'for fun'. I'll just keep the same one earh theoretical year for this:</p>
<img alt="Figure_08" src="/images/figi08.png" />
<div class="line-block">
<div class="line"><br /></div>
</div>
<img alt="Figure_09" src="/images/figi09.png" />
<p>So clearly the orbits aren't going to come even close. Luckily there are better methods that can be extended to generalized multibody problems.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="section" id="scene-ii-enter-runge-and-kutta">
<h3>Scene II:  Enter Runge and Kutta</h3>
<p>Newton did find some better ways to solve for the position of an object in an eliptical orbit as a function of time, but we’re going to do some more complicated calculations (multi-body, 3D) so let’s move on.</p>
<p>Around 1900, Carl Runge and Martin Wilhelm Kutta developed a system for finding better algorithms for solving ODEs involving time-varying effects. (Wikipedia) This family is called Runge-Kutta algorithms. You can read about these everywhere. The simplest or most common is called RK4, or “THE” Runge-Kutta algorithm. Here it is implemented for simultaneous velocity and position expressions. The function a is “acceleration” (F/m). Be careful to note the x and v subscripts as they are written.</p>
<p>This method is fourth order, so the error (per step) is O(5). Since the number of steps must increase as step size decreases, we can expect the total error to drop as step size to the fourth power.</p>
<img alt="Figure_10" src="/images/figi10w.png" />
<img alt="Figure_11" src="/images/figi11w.png" />
<p>A second, popular algorithm is the Runge-Kutta-Fehlberg or RK45. This method is also fourth order, but more accurate. It uses many more coeficeints and floating point operations per step, but with a few more calculations it provides a fifth order solution as well. This can be compared to estimate the approximate size of the error. This comparison can be used to adjust the step size h dynamically, so time is not wasted “over-calculating”. But you have to think about how often and when you change the step size so that it makes sense for your calculation.</p>
<img alt="Figure_12" src="/images/figi12fixedw.png" />
<div class="line-block">
<div class="line"><br /></div>
</div>
<img alt="Figure_13" src="/images/figi13fixedw.png" />
<p>I won't give you all the coeifients (b<sub>i,j</sub> , c<sub>i</sub> , d<sub>i</sub>) because I don't want to be responsible for any errors. You'll have to look those up yourself.</p>
<p>It converges much faster! For eccentric and unusual orbits, you should try to use an even higher order RK algorithm.  There are many to choose from!</p>
<img alt="Figure_15" src="/images/figi15.png" />
<p>So we can see both methods are the same order of accuracy. Each step is O(5), and the total number of steps increases as the step size decreases, so the final error drops as step-size to the minus four power.  The RK45 method is about a factor of 10 more accurate. You may wonder why you might want to use it. You can get the same accuracy (at least in this example) with RK4 by using 10<sup>1/4</sup> , or about twice the nubmer of steps, which may be faster than using RK45 with roughly 5 times the number of floats and 50% more calls to the subroutine for acceleration. The benefit is that with just a few more floats, you can get the fifth order result as well, and use it to constantly check your accuracy.</p>
<p>The value s can be used as a multiplicitave adjustment to the step size. If s consistently is much larger than one, the step size can be multiplied by s. If s is much less than one, then multiply the step size by s to decrease it an amount to bring the error back in to the same ballpark as tol. These are just guidelines, it needs some attention to decide if, and how best to use. You actually get SIX values for s (3 position, 3 velocity). One could be conservative and always use the smallest of the six.</p>
<p>If you want to try it, the RK45 method (Runge-Kutta-Fehlberg) is very popular and you can read about it wherever ODEs are sold.</p>
<img alt="Figure_14" src="/images/figi14w.png" />
</div>
<div class="section" id="next">
<h3>NEXT:</h3>
<p>In Orbit II we'll use RK methods to calculate some 3-body problems, like Sun-Earth-moon and Sun-Jupiter-Earth.</p>
<p>In Orbit III we'll do some even more interesting stuff!</p>
</div>
</div>

</article>

        <footer>
            <nav>
                <ul>
                    <li><a href="/pages/useful-links.html">Useful Links</a></li>
                    <li>:: <a href="/categories.html">Categories</a></li>
                </ul>
            </nav>
                <p id="theme-credit">Proudly powered by <a href="http://docs.notmyidea.org/alexis/pelican/">pelican</a></p>
        </footer>

</body>
</html>